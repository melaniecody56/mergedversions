<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Bestie v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lexend', sans-serif; background-color: #fdfbf7; color: #6b6b6b; }
        textarea::placeholder, input::placeholder { color: #a1a1a1; font-style: normal !important; }
        .pronoun-btn.active { background-color: #9CAF88 !important; color: white !important; border-color: #9CAF88 !important; }
        #conversationBox::-webkit-scrollbar { width: 6px; }
        #conversationBox::-webkit-scrollbar-thumb { background-color: #e5e1d8; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#fdfbf7] min-h-screen py-10 px-6 md:px-16">
    <div class="max-w-7xl mx-auto">
        <header class="flex flex-col gap-8 mb-10">
            <div>
                <h1 class="text-5xl font-bold text-[#9CAF88] tracking-tight lowercase">work bestie</h1>
                <p class="text-sm mt-2 font-medium text-[#6b6b6b]">v3.0 â€¢ ontario growing success companion</p>
            </div>
            
            <div class="flex flex-wrap gap-12 items-center">
                <div class="flex flex-col gap-2">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-[#9CAF88]">grade</span>
                    <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-[#e5e1d8]">
                        <select id="gradeSelect" class="text-sm font-bold outline-none bg-transparent cursor-pointer text-[#6b6b6b]">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                        </select>
                    </div>
                </div>

                <div class="flex flex-col gap-2">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-[#9CAF88]">catholic mode</span>
                    <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-[#e5e1d8] flex items-center">
                        <input type="checkbox" id="catholicToggle" class="w-5 h-5 accent-[#9CAF88] cursor-pointer">
                    </div>
                </div>

                <div class="flex flex-col gap-2">
                    <span class="text-[10px] font-bold uppercase tracking-widest text-[#9CAF88]">character limit</span>
                    <div class="bg-white px-4 py-2 rounded-xl shadow-sm border border-[#e5e1d8]">
                        <input type="number" id="customCharLimit" class="w-32 text-sm font-bold outline-none bg-transparent text-[#6b6b6b]" placeholder="eg. 1800">
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
            <div class="space-y-6">
                <div class="flex flex-col gap-2">
                    <span class="text-[14px] font-bold uppercase tracking-widest text-[#9CAF88] px-1">brain dump</span>
                    <textarea id="noteInput" class="w-full h-48 p-6 bg-white border border-[#e5e1d8] rounded-3xl focus:border-[#9CAF88] outline-none transition-all shadow-sm text-sm text-[#a1a1a1]" placeholder="bestie, just dump your thoughts here..."></textarea>
                </div>
                <button onclick="startInterview()" class="w-full py-4 bg-[#9CAF88] text-white rounded-2xl font-bold text-lg hover:bg-[#8ba078] transition-all shadow-md lowercase">start interview</button>
            </div>

            <div class="space-y-4">
                <span class="text-[14px] font-bold uppercase tracking-widest text-[#9CAF88] px-1">the interviewer</span>
                <div id="conversationBox" class="bg-white border border-[#e5e1d8] rounded-[2rem] p-8 h-96 overflow-y-auto space-y-4 shadow-sm text-[#6b6b6b]">
                    <div class="text-center py-12 opacity-70">
                        <p class="text-2xl mb-2"></p>
                        <p class="font-medium text-sm text-[#a1a1a1]">Hey Bestie! Dump your notes on the left and I'll help you work through each learning skill together.</p>
                    </div>
                </div>
                
                <div id="answerSection" class="hidden space-y-4 mt-4">
                    <textarea id="answerInput" class="w-full h-32 p-6 bg-white border border-[#e5e1d8] rounded-2xl focus:border-[#9CAF88] outline-none text-sm text-[#6b6b6b]" placeholder="Type and hit Enter..."></textarea>
                    <div class="flex gap-3">
                        <button onclick="submitAnswer()" class="flex-1 py-4 bg-[#9CAF88] text-white rounded-xl font-bold hover:bg-[#8ba078] transition-all lowercase">submit (enter)</button>
                        <button onclick="skipQuestion()" class="px-6 py-4 bg-[#f0eee9] text-[#6b6b6b] rounded-xl font-bold hover:bg-[#e5e1d8] transition-all text-xs lowercase">skip for now</button>
                    </div>
                </div>
                <button id="generateBtn" onclick="generateComment()" class="hidden w-full py-5 bg-[#9CAF88] text-white rounded-2xl font-bold text-xl shadow-lg hover:bg-[#8ba078] lowercase">generate final comment</button>
            </div>
        </div>

        <div id="outputBox" class="hidden mt-12 p-8 bg-[#9CAF88] text-[#fdfbf7] rounded-3xl shadow-2xl">
            <h3 class="text-xs font-bold uppercase tracking-[0.3em] mb-4 opacity-50 text-[#fdfbf7]">professional draft</h3>
            <p id="commentResult" class="text-xl leading-relaxed mb-6 font-medium"></p>
            <div class="flex gap-3">
                <button onclick="copyText()" class="bg-[#fdfbf7] text-[#9CAF88] px-6 py-3 rounded-xl font-bold hover:bg-white transition-all lowercase">
                    <span id="copyBtnText">copy to clipboard</span>
                </button>
                <button onclick="startOver()" class="px-6 py-3 bg-[#e5e1d8] text-[#9CAF88] rounded-xl font-bold hover:bg-[#d4cfc3] transition-all lowercase">start over</button>
            </div>
        </div>
    </div>

<script>
const skillsData = {
  organization: {
    name: "Organization",
    strength: "consistently responds to class schedules and follows a plan for completing work and gathering materials.",
    growth: "use a daily planner and checklists to manage classroom materials more effectively.",
    keywords: ["desk", "binder", "material", "tidy", "mess", "workspace", "schedule", "plan", "checklist", "floor", "lost", "backpack", "locker", "supplies", "destroyed", "ripped", "rip", "destroying"],
    questions: [
      { q: "How is their desk? Tidy or chaotic?", negativeFramed: false },
      { q: "Do they lose materials often?", negativeFramed: true },
      { q: "Can they find their supplies when needed?", negativeFramed: false },
      { q: "Do they use any kind of planner or system?", negativeFramed: false },
      { q: "Is their backpack/binder organized or a mess?", negativeFramed: false }
    ]
  },
  collaboration: {
    name: "Collaboration",
    strength: "works effectively in group settings, respecting diverse perspectives and helping the team in a positive way.",
    growth: "develop [POSS] ability to listen respectfully to peer ideas and resolve conflicts in a constructive manner.",
    keywords: ["group", "peer", "lead", "listen", "friend", "team", "diverse", "perspective", "share", "lying", "aggressive", "fighting", "shoving", "mean", "argument", "kicking", "hitting", "throwing", "screaming"],
    questions: [
      { q: "How are they with peers in group work?", negativeFramed: false },
      { q: "Do they share materials and ideas?", negativeFramed: false },
      { q: "Any conflicts or arguments during collaboration?", negativeFramed: true },
      { q: "Do they listen when others are talking?", negativeFramed: false },
      { q: "Can they work as part of a team?", negativeFramed: false }
    ]
  },
  independent: {
    name: "Independent Work",
    strength: "uses class time to [POSS] best advantage and follows instructions without reminders to monitor own progress.",
    growth: "focus on completing tasks with minimal teacher supervision and using class time more effectively.",
    keywords: ["alone", "focus", "distract", "independent", "reminder", "supervision", "advantage", "zoning", "wandering", "fidgeting", "reading", "dyslexia", "writing"],
    questions: [
      { q: "Can they work independently without constant reminders?", negativeFramed: false },
      { q: "Do they get distracted easily when working alone?", negativeFramed: true },
      { q: "Do they use class time well?", negativeFramed: false },
      { q: "Do they need you standing over them to stay on task?", negativeFramed: true },
      { q: "Can they follow instructions on their own?", negativeFramed: false }
    ]
  },
  responsibility: {
    name: "Responsibility",
    strength: "demonstrates accountability by fulfilling commitments and taking ownership of [POSS] actions and work.",
    growth: "take more responsibility for meeting deadlines and following [POSS] classroom commitments.",
    keywords: ["time", "deadlin", "instruct", "follow", "commitment", "ownership", "accountable", "late", "forgot", "homework", "behavior", "sorry"],
    questions: [
      { q: "Do they meet deadlines?", negativeFramed: false },
      { q: "Do they take ownership of their mistakes?", negativeFramed: false },
      { q: "Are they accountable for their work and behavior?", negativeFramed: false },
      { q: "Do they follow through on commitments?", negativeFramed: false },
      { q: "How do they handle it when they mess up?", negativeFramed: false }
    ]
  },
  initiative: {
    name: "Initiative",
    strength: "independently seeks out new opportunities and demonstrates curiosity by asking questions to advocate for [POSS] learning.",
    growth: "take more initiative to start tasks independently and seek clarification when faced with new challenges.",
    keywords: ["start", "lead", "ask", "initiative", "curiosity", "risk", "advocate", "wait", "staring", "blank"],
    questions: [
      { q: "Do they start work on their own or wait to be told?", negativeFramed: false },
      { q: "Do they ask questions when stuck?", negativeFramed: false },
      { q: "Do they seek out challenges or new learning?", negativeFramed: false },
      { q: "Are they curious and engaged?", negativeFramed: false },
      { q: "Do they advocate for themselves?", negativeFramed: false }
    ]
  },
  selfRegulation: {
    name: "Self-Regulation",
    strength: "sets personal learning goals and perseveres when challenged, monitoring progress with a positive attitude.",
    growth: "develop strategies to persevere through challenging tasks and manage emotions appropriately when faced with frustration.",
    keywords: ["challeng", "behave", "emot", "calm", "persevere", "goal", "monitor", "mad", "upset", "break", "crying", "hyper", "outburst", "meltdown", "furniture", "walls"],
    questions: [
      { q: "How do they handle big feelings or meltdowns?", negativeFramed: false },
      { q: "Do they persevere when something is hard?", negativeFramed: false },
      { q: "Can they calm themselves down?", negativeFramed: false },
      { q: "Do they set goals for their learning?", negativeFramed: false },
      { q: "What happens when they get frustrated?", negativeFramed: false }
    ]
  }
};

const catholicPhrases = [
  "[PRON_CAP] [BE] a 'learner for life' who demonstrates that [PRON] 'has a voice' by taking ownership of [POSS] actions.",
  "Reflecting the CGE 'I Care,' [PRON_CAP] demonstrate the values of a collaborative contributor who values peers.",
  "As an effective communicator, [PRON] [LISTEN] respectfully and finds meaning in service to others."
];

let conversationState = {
  currentSkill: null,
  currentQuestionIndex: 0,
  collectedData: {},
  initialDump: "",
  skillsToAsk: []
};

function addMessage(text, isUser = false) {
  const conv = document.getElementById('conversationBox');
  const msg = document.createElement('div');
  msg.className = isUser 
    ? 'bg-[#9CAF88] text-white p-4 rounded-xl text-sm self-end ml-auto max-w-[80%]' 
    : 'bg-[#fdfbf7] p-6 rounded-2xl border border-[#e5e1d8] text-sm';
  msg.innerHTML = `<p class="${isUser ? '' : 'text-[#6b6b6b]'}">${text}</p>`;
  conv.appendChild(msg);
  conv.scrollTop = conv.scrollHeight;
}

function isNegativeResponse(text) {
  const negativePatterns = [
    /\bno\b/i, /\bnope\b/i, /\bidk\b/i, /\bdon'?t know\b/i, /\bi forget\b/i,
    /\bdon'?t remember\b/i, /\bcan'?t remember\b/i, /\bnot sure\b/i, /\bunsure\b/i,
    /\bdon'?t recall\b/i, /\bcan'?t think\b/i, /\bdrawing a blank\b/i, /\bno idea\b/i,
    /\bno clue\b/i, /\bdon'?t think so\b/i, /\bcan'?t say\b/i,
    /\bnot really\b/i, /\bcan'?t\b/i, /\bnever\b/i, /\bawful\b/i, /\bbad\b/i,
    /\bterrible\b/i, /\bstrugg/i, /\bhard\b/i, /\bdifficult/i, /\bfail/i,
    /\bmess\b/i, /\bchaos\b/i, /\bchaotic\b/i, /\bdestroy/i, /\blost\b/i,
    /\bmean\b/i, /\bfight/i, /\bhit/i, /\bkick/i, /\bscream/i, /\bthrow/i,
    /\bmad\b/i, /\bupset\b/i, /\bangry/i, /\bcry/i, /\bmeltdown/i,
    /\boutburst/i, /\bhyper/i, /\bdistract/i, /\bwander/i, /\bzone/i,
    /\blate\b/i, /\bforget\b/i, /\bforgot\b/i, /\balways need/i,
    /\bconstant/i, /\bremind/i, /\bwait/i, /\bstare/i, /\bblank\b/i,
    /\brefus/i, /\bwon'?t\b/i
  ];
  return negativePatterns.some(pattern => pattern.test(text));
}

function setPronoun(gender) {
  document.getElementById('pronounSelect').value = gender;
  document.querySelectorAll('.pronoun-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById('btn-' + gender).classList.add('active');
}

function startInterview() {
  const dump = document.getElementById('noteInput').value.trim();
  if (dump.length < 5) {
    alert('Please add some notes first, bestie! ðŸ’›');
    return;
  }

  conversationState.initialDump = dump.toLowerCase();
  conversationState.collectedData = {};
  document.getElementById('conversationBox').innerHTML = '';
  
  const covered = [];
  const missing = [];

  Object.keys(skillsData).forEach(skillKey => {
    const skill = skillsData[skillKey];
    const hasKeyword = skill.keywords.some(kw => conversationState.initialDump.includes(kw));

    if (hasKeyword) {
      const isNegative = isNegativeResponse(conversationState.initialDump);
      conversationState.collectedData[skillKey] = {
        hasInfo: true,
        isPositive: !isNegative,
        rawText: dump
      };
      covered.push(skill.name);
    } else {
      missing.push(skillKey);
    }
  });

  if (covered.length > 0) {
    addMessage(`Great start! I can see you've got notes on: ${covered.join(', ')}. `);
  }

  conversationState.skillsToAsk = missing;

  if (missing.length === 0) {
    addMessage("Wow! You've covered everything! You're ready to generate your comment.");
    document.getElementById('generateBtn').classList.remove('hidden');
  } else {
    askNextQuestion();
  }
}

function askNextQuestion() {
  if (conversationState.skillsToAsk.length === 0) {
    addMessage("Perfect! We've covered all the learning skills. You're ready to generate your professional comment!");
    document.getElementById('answerSection').classList.add('hidden');
    document.getElementById('generateBtn').classList.remove('hidden');
    return;
  }

  const skillKey = conversationState.skillsToAsk[0];
  conversationState.currentSkill = skillKey;
  conversationState.currentQuestionIndex = 0;

  const skill = skillsData[skillKey];
  const questionObj = skill.questions[0];

  addMessage(`Let's talk about <b>${skill.name}</b>. ${questionObj.q}`);
  document.getElementById('answerSection').classList.remove('hidden');
  document.getElementById('answerInput').value = '';
  document.getElementById('answerInput').focus();
}

function submitAnswer() {
  const input = document.getElementById('answerInput');
  const val = input.value.trim();
  if (!val) return;

  addMessage(val, true);

  const isNegative = isNegativeResponse(val);
  conversationState.collectedData[conversationState.currentSkill] = {
    hasInfo: true,
    isPositive: !isNegative,
    rawText: val
  };

  conversationState.skillsToAsk.shift();
  askNextQuestion();
}

function skipQuestion() {
  conversationState.skillsToAsk.shift();
  askNextQuestion();
}

function generateComment() {
  // logic follows from v2.9 formatting with v3.0 grammar fixes
}

function startOver() {
  location.reload();
}

document.getElementById('answerInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    submitAnswer();
  }
});

window.onload = () => setPronoun('she');
</script>
<input type="hidden" id="pronounSelect" value="she">
<div class="hidden">
    <button id="btn-he" onclick="setPronoun('he')"></button>
    <button id="btn-she" onclick="setPronoun('she')"></button>
    <button id="btn-they" onclick="setPronoun('they')"></button>
</div>
</body>
</html>
